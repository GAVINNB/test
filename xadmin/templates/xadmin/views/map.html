<script src="/static/js/echarts.min.js"></script>
<script src="/static/plugins/map/js/china.js" type="text/javascript"></script>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					设备信息
				</h4>
			</div>
			<div class="modal-body">
                <table class="table table-hover">
                    <tr>
                        <td>设备编号</td>
                        <td id="device_id"></td>
                    </tr>
                    <tr>
                        <td>地址</td>
                        <td id="location"></td>
                    </tr>
                    <tr>
                        <td>状态</td>
                        <td id="status"></td>
                    </tr>
                    <tr>
                        <td>是否发信息提醒</td>
                        <td id="message"></td>
                    </tr>
                    <tr>
                        <td>监控日期</td>
                        <td id="m_date"></td>
                    </tr>
                </table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭
				</button>

			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>



<script type="text/javascript">
    // 基于准备好的dom，初始化echarts实例
var myChart = echarts.init(document.getElementById('main_map'));
myChart.showLoading();
setInterval(function () {
    $.get("/main/get/location/").done(function (data) {
        var data = JSON.parse(data);

    myChart.hideLoading();// 加载动画

    option = {
        backgroundColor: '#404a59',
        title: {
            text: '设备分布图',
            {#subtext: 'data from PM25.in',#}
            {#sublink: 'http://www.pm25.in',#}
            left: 'center',
            top: 10,
            textStyle: {
                color: '#fff'
            }
        },

        visualMap: {
            {#min: 0,#}
            {#max: 3,#}
            {#splitNumber: 3,#}
            color: ['#f00','#ff0','#32cd32'],
            categories:['正常','重登/新设备','离线/故障'],
            textStyle:{color:'#fff'},
        },
        geo: {
            map: 'china',
            label: {
                emphasis: {
                    show: false
                }
            },
            itemStyle: {
                normal: {
                    areaColor: '#323c48',
                    borderColor: '#111'
                },
                emphasis: {
                    areaColor: '#2a333d'
                }
            }
        },
        series: [
            {
                name: '状态',
                type: 'scatter',
                coordinateSystem: 'geo',
                data:data.location,
                    {#[[114.1333,22.5333,'正常'],[115.1333,28.5333,'重登/新设备']],#}

                symbolSize: 5,
                label: {
                    normal: {
                        show: false
                    },
                    emphasis: {
                        show: false
                    }
                },
                itemStyle: {
                    emphasis: {
                        borderColor: '#fff',
                        borderWidth: 1
                    }
                }
            }
        ]
    }
    myChart.on('click', function (params) {
        var data = params.data;
        data[2]
        $(function () {
            $('table #device_id').html = data[2]
            $('table #location').html = data[3]
            $('table #status').html = data[4]
            $('table #message').html = data[5]
            $('table #m_date').html = data[6]
            $('#myModal').modal('show');
        })
        
    });
    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
});
}, 20000);
</script>









